<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iOCIgZmlsbD0iI2ZmZiIvPjxnPjxwYXRoIGQ9Ik0xNiA4YzQuNDIgMCA4IDMuNTggOCA4IDAgNC40Mi0zLjU4IDgtOCA4LTQuNDIgMC04LTMuNTgtOC04IDAtNC40MiAzLjU4LTggOC04eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik0xNiA4YzIuMjEgMCA0LjI2Ljg5IDUuNzkgMi4zM0MxOS44NSAxMC4zIDE3Ljg2IDkgMTYgOXMtMy44NS4zLTEuNzkgMS4zM0MxMS43NCA4Ljg5IDEzLjc5IDggMTYgOHoiIGZpbGw9IiNjNjBjMzAiLz48cGF0aCBkPSJNMTYgMjRjLTIuMjEgMC00LjI2LS44OS01Ljc5LTIuMzNDMTIuMTUgMjEuNyAxNC4xNCAyMyAxNiAyM3MzLjg1LS4zIDEuNzktMS4zM0MyMC4yNiAyMy4xMSAxOC4yMSAyNCAxNiAyNHoiIGZpbGw9IiMwMDM0Nzg2Ii8+PC9nPjxnPjxwYXRoIGQ9Ik0yNiA2LjVsLjctLjcgMS42NSAxLjY1LS43LjctMS42NS0xLjY1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik02IDI1LjVsLjctLjcgMS42NSAxLjY1LS43LjctMS42NS0xLjY1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik0yNiAyNS41bC0uNy0uNy0xLjY1IDEuNjUuNy43IDEuNjUtMS42NXoiIGZpbGw9IiMwMDAiLz48cGF0aCBkPSJNNiA2LjVsLS43LS43LTEuNjUgMS42NS43LjcgMS42NS0xLjY1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik0yOSAyM2gtMXYtM2gxdjN6IiBmaWxsPSIjMDAwIi8+PHBhdGggZD0iTTMgOWgxVjZoLTF2M3oiIGZpbGw9IiMwMDAiLz48cGF0aCBkPSJNMjkgOWgtMXYtM2gxdjN6IiBmaWxsPSIjMDAwIi8+PHBhdGggZD0iTTMgMjNoMXYzaC0xdi0zeiIgZmlsbD0iIzAwMCIvPjwvZz48L3N2Zz4=" >
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  /* Typographie optimisée pour Galaxy S25 Ultra */
  html {
    font-size: 17px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  body {
    letter-spacing: 0.01rem;
    line-height: 1.6;
  }
  h1, h2, h3, .day-title {
    letter-spacing: -0.01em;
    font-weight: 800;
  }
  p, .activity-text {
    line-height: 1.65;
    color: #1f2937;
  }
  .text-label {
    font-weight: 600;
    color: #4b5563;
  }
  @media (max-width: 600px) {
    html { font-size: 17px; }
    body { 
      padding-bottom: env(safe-area-inset-bottom, 24px);
      padding-left: env(safe-area-inset-left, 16px);
      padding-right: env(safe-area-inset-right, 16px);
      max-width: 100vw;
      overflow-x: hidden;
    }
    .footer-btn, .footer-btn * { font-size: 1.1em; }
  }
  /* Optimisation pour écrans larges Galaxy Ultra */
  @media (min-width: 412px) {
    .container {
      padding-left: 16px;
      padding-right: 16px;
      max-width: 100%;
    }
  }
  footer, .footer {
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }
  .footer-btn {
    min-width: 72px;
    min-height: 56px;
    padding: 8px 0 4px 0;
    border-radius: 16px;
    margin: 0 4px;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 0.2s;
  }
  .footer-btn:active, .footer-btn:focus {
    background: #e0e7ff;
    outline: none;
  }
  .footer-btn i {
    font-size: 32px !important;
    margin-bottom: 2px;
  }
  .footer-btn span {
    font-size: 0.95em;
    font-weight: 600;
    margin-top: 2px;
  }
  #search-input {
    min-height: 52px;
    font-size: 1.1em;
    border-radius: 12px;
    padding: 12px 16px 12px 40px;
  }
  .day-card, .place-card {
    border-radius: 22px;
    padding: 22px 16px;
    margin-bottom: 1px;
    font-size: 1.09em;
    box-shadow: 0 4px 18px 0 #00000018, 0 1.5px 3px #00000009;
  }
  .day-card .titre-activite, .place-card .titre-lieu, .moment-label {
    font-size: 1.18em;
    font-weight: bold;
    margin-bottom: 6px;
    letter-spacing: 0.01em;
  }
  .action-btn, .mark-done-btn {
    display: block !important;
    width: 92% !important;
    margin: 14px auto 0 auto !important;
    padding: 16px 0 !important;
    font-size: 1.12em !important;
    font-weight: 700 !important;
    border-radius: 14px !important;
    background: #6366f1 !important;
    color: #fff !important;
    box-shadow: 0 2px 10px #6366f133 !important;
    text-align: center !important;
    min-height: 48px;
    transition: background 0.18s, box-shadow 0.18s;
  }
  .action-btn:active, .mark-done-btn:active {
    background: #4338ca !important;
  }
  .lieu-card {
    cursor: pointer;
    width: 100%;
    display: block;
    padding: 10px 0;
  }
  .activity-block, .lieu-block {
    margin-bottom: 18px;
  }
  .mark-done-btn {
    width: 140px !important;
    min-width: 140px !important;
    max-width: 140px !important;
    display: inline-flex !important;
    justify-content: center !important;
    align-items: center !important;
    white-space: nowrap !important;
    overflow: visible !important;
    padding: 6px 10px !important;
    font-size: 0.88em !important;
    border-radius: 6px !important;
    text-align: center !important;
    background-color: #6366f1 !important;
    color: white !important;
    margin-left: auto !important;
    line-height: 1.2 !important;
  }

  .location-badge {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    height: 32px !important;
    min-height: 32px !important;
    max-height: 32px !important;
    padding: 0 12px !important;
    margin: 4px !important;
    border-radius: 16px !important;
    background-color: #f3f4f6 !important;
    color: #4b5563 !important;
    font-size: 0.9em !important;
    font-weight: 500 !important;
    white-space: nowrap !important;
    border: 1px solid #e5e7eb !important;
  }

  .dark-mode .location-badge {
    background-color: #232946 !important;
    color: #fff !important;
    border-color: #88a !important;
    box-shadow: 0 2px 6px rgba(30, 41, 59, 0.25) !important;
  }
  
  .dark-mode .location-badge.completed,
  .dark-mode .mark-done-btn.completed {
    background-color: #10b981 !important;
    color: #e6ffed !important;
    border-color: #34d399 !important;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.12) !important;
  }
  
  .mark-done-btn.completed {
    background-color: #10b981 !important;
    color: #fff !important;
    color: white !important;
  }
  .timeline-btn, .nav-btn, .step-btn, .day-nav-btn {
    border-radius: 24px !important;
    background: #e0e7ff !important;
    color: #1e293b !important;
    font-size: 1.18em !important;
    font-weight: 700 !important;
    padding: 18px 26px !important;
    margin: 0 10px !important;
    box-shadow: 0 4px 18px #6366f133 !important;
    min-height: 52px;
    min-width: 88px;
    transition: background 0.18s, box-shadow 0.18s, transform 0.13s;
    outline: none;
    border: none;
    position: relative;
  }
  .timeline-btn:active, .nav-btn:active, .step-btn:active, .day-nav-btn:active {
    background: #c7d2fe !important;
    box-shadow: 0 6px 24px #6366f144 !important;
    transform: scale(0.98);
  }
  .timeline-btn:focus-visible, .nav-btn:focus-visible, .step-btn:focus-visible, .day-nav-btn:focus-visible {
    box-shadow: 0 0 0 3px #6366f1cc !important;
  }
  .day-nav-btn[disabled] {
    opacity: 0.4 !important;
    pointer-events: none !important;
  }
  .timeline-btn:active, .nav-btn:active, .step-btn:active {
    background: #c7d2fe !important;
    box-shadow: 0 4px 16px #6366f133 !important;
  }

  .timeline {
    padding-bottom: 8px;
  }
  /* Safe area for iOS/Android */
  body {
    padding-bottom: env(safe-area-inset-bottom, 24px);
  }
</style>
    <title>Séoul 2025 - Itinéraire Interactif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #3b82f6;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f9fafb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 0.5rem;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f3f4f6;
            color: var(--text-color);
        }
        /* Micro-animations et transitions pour une expérience moderne */
        .micro-animation {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .day-card:hover,
        .lieu-card:hover,
        .button:hover {
            transform: translateY(-2px);
        }
        .action-btn, .mark-done-btn {
            transition: transform 0.2s, background-color 0.3s !important;
        }
        .action-btn:active, .mark-done-btn:active {
            transform: scale(0.98);
        }
        main {
            flex: 1;
        }
        .primary-gradient {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        .secondary-gradient {
            background: linear-gradient(135deg, #f97316, var(--accent-color));
        }
        .success-gradient {
            background: linear-gradient(135deg, #059669, var(--success-color));
        }
        .purple-gradient {
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
        }
        .day-card {
            transition: all 0.3s ease;
            border-radius: var(--radius);
            overflow: hidden;
            background-color: #fff;
            color: #1f2937;
        }
        .day-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        .day-card.active {
            border-left: 4px solid var(--primary-color);
        }
        /* Fil d'Ariane amélioré */
        .breadcrumb-item {
            transition: all 0.3s ease;
            color: var(--text-light);
        }
        .breadcrumb-item.active {
            font-weight: 600;
            color: var(--primary-color);
        }
        /* Barre de recherche améliorée */
        #searchInput {
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }
        #searchInput:focus {
            width: 100%;
            box-shadow: var(--shadow);
            border-color: var(--primary-color);
        }
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        /* Carte animée pour afficher la progression */
        .progress-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: all 0.3s ease;
        }
        .progress-ring-circle {
            stroke: var(--primary-color);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s ease;
        }
        .progress-ring-background {
            stroke: #e5e7eb;
        }
        /* Bouttons plus jolis */
        /* Carte des lieux */
        .place-card {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        .place-card:hover {
            border-left-color: var(--accent-color);
            background-color: rgba(249, 250, 251, 0.8);
        }
        /* Timeline */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-100">
    <header class="sticky top-0 z-50 bg-white shadow-md border-b">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <h1 class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-plane-departure mr-2 text-indigo-600"></i>
                    Séoul 2025
                </h1>
                <div class="flex space-x-3">
                    <button id="searchButton" class="p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200">
                        <i class="fas fa-search"></i>
                    </button>
                    <button id="toggleNotdone" class="p-2 rounded-full bg-green-100 text-green-600 hover:bg-green-200">
                        <i class="fas fa-list-check"></i>
                    </button>
                </div>
            </div>
            <div id="search-bar" class="mt-3 hidden fade-in">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" id="search-input" 
                        class="w-full pl-10 pr-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Rechercher un lieu, une activité...">
                </div>
                <div id="search-results" class="mt-2 max-h-60 overflow-y-auto bg-white rounded-lg shadow-lg hidden"></div>
            </div>
            <div class="mb-2">
                <div class="breadcrumb overflow-x-auto whitespace-nowrap py-1 text-sm mb-0">
                    <span id="breadcrumb-home" class="breadcrumb-item active flex items-center cursor-pointer hover:underline">
                        <i class="fas fa-home mr-1"></i>
                        Accueil
                    </span>
                    <span id="breadcrumb-separator" class="mx-1 hidden text-gray-400">→</span>
                    <span id="breadcrumb-day" class="breadcrumb-item hidden"></span>
                </div>
            </div>
        </div>
    </header>
    <header class="sticky top-0 z-50 bg-white shadow-md border-b">
    </header>
    <main class="flex-1 pb-24 p-4">
        <div id="home-view" class="space-y-4">
            <div class="bg-gradient-to-r from-indigo-500 to-blue-400 rounded-xl p-4 mb-6 shadow-lg text-white flex items-center justify-between">
                <div class="flex flex-col items-start">
                    <div class="text-xl font-bold">Itinéraire Séoul</div>
                    <div class="text-xs opacity-90">4 au 21 Mai 2025</div>
                    <div class="inline-flex space-x-2 mt-2">
                    </div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="relative w-12 h-12">
                        <svg class="progress-ring" width="48" height="48">
                            <circle class="progress-ring__circle" stroke="white" stroke-width="6" fill="transparent" r="18" cx="24" cy="24"/>
                        </svg>
                        <span id="completion-rate" class="absolute inset-0 flex items-center justify-center text-sm font-bold">0%</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-4 mb-6">
                <div class="font-semibold text-indigo-700 mb-2 flex items-center"><i class="fas fa-route mr-2"></i>Timeline du voyage</div>
                <div id="timeline" class="flex overflow-x-auto space-x-4 hide-scrollbar pb-2"></div>
            </div>
            <div id="days-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-4"></div>
            </div>
        </div>
        <div id="notdone-view" class="hidden space-y-4 fade-in">
            <div id="location-status" class="mb-4"></div>
            <div id="notdone-places" class="mt-6 space-y-2">
                <div class="text-center py-6 text-gray-500">
                    <img src="https://cdn.iconscout.com/icon/free/png-256/free-location-pin-find-place-position-navigation-3-27063.png" alt="Location" class="w-16 h-16 mx-auto opacity-50 mb-3">
                    <p>Activez la localisation pour voir les activités à proximité</p>
                </div>
            </div>
        </div>
        </div>
        <div id="day-detail-view" class="hidden fade-in">
        </div>
    </main>
    <footer class="fixed bottom-0 left-0 w-full bg-white border-t">
  <div class="flex justify-around items-center py-2">
    <button id="btn-home" class="flex flex-col items-center p-2 text-gray-600 hover:text-indigo-600 transition-colors">
      <i class="fas fa-home text-xl"></i>
      <span class="text-xs mt-1">Accueil</span>
    </button>
    <button id="btn-notdone" class="flex flex-col items-center p-2 text-gray-600 hover:text-indigo-600 transition-colors">
      <i class="fas fa-list-check text-xl"></i>
      <span class="text-xs mt-1">Activités non réalisées</span>
    </button>
  </div>
</footer>
        </div>
    </footer>
      <script>
        // Données de l'itinéraire avec les modifications demandées
        const itineraireSeoul = [
            {
                id: '1',
                date: '2025-05-04',
                titre: 'Arrivée et découverte à Hongdae',
                activites: {
                    'Après-midi': {
                        texte: 'Arrivée à ICN à 15h40. Rejoindre le Airbnb à Yeongdeungpo-gu ; Balade Yeouido Park + Munhwa Pedestrian Bridge, le long de Han River',
                        lieux: [
                            {
                                nom: 'Airbnb',
                                adresse: '서울 영등포구 영등포로3길 23 코업레지던스 오목교 1123호 (07276)',
                                kakaoMapUrl: 'https://map.kakao.com/?q=서울 영등포구 영등포로3길 23 코업레지던스 오목교 1123호'
                            },
                            {
                                nom: 'Yeouido Park',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Yeouido Park'
                            }
                        ],
                        transport: 'AREX ou KAL Limousine → Ligne 5'
                    },
                    'Soirée': {
                        texte: 'Pause au café Sinleedoga. Promenade dans Hongdae, découverte d\'artistes de rue (+ busking), dîner street food (tteokbokki ou hotteok)',
                        lieux: [
                            {
                                nom: 'Sinleedoga Café',
                                adresse: '서울 마포구 잔다리로 20-12',
                                kakaoMapUrl: 'https://map.kakao.com/?q=서울 마포구 잔다리로 20-12'
                            },
                            {
                                nom: 'Hongdae Street',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Hongdae Street'
                            }
                        ],
                        transport: 'Ligne 5 → Ligne 2'
                    }
                }
            },
            {
                id: '2',
                date: '2025-05-05',
                titre: 'Culture et histoire',
                activites: {
                    'Matin': {
                        texte: 'Visite Gyeongbokgung Palace avec hanbok',
                        lieux: [
                            {
                                nom: 'Gyeongbokgung Palace',
                                adresse: '127-6 Sajik-ro, Jongno-gu, Seoul, South Korea',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Gyeongbokgung Palace',
                                notes: 'RDV: 8h30 - Meet in front of the bench at exit 4 of Gyeongbokgung station. Your guide will be waiting for you, holding a TRIPPER SIGH.'
                            }
                        ],
                        transport: 'Ligne 3 - Station Gyeongbokgung, Sortie 4'
                    },
                    'Après-midi': {
                        texte: 'Déjeuner Gwangjang Market (bindaetteok ou kimbap) et visite du (Buddha\'s Birthday) Jogyesa Temple',
                        lieux: [
                            {
                                nom: 'Gwangjang Market',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Gwangjang Market'
                            },
                            {
                                nom: 'Jogyesa Temple',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Jogyesa Temple'
                            }
                        ],
                        transport: 'Ligne 1 - Station Jonggak'
                    },
                    'Soirée': {
                        texte: 'Découverte de Cheonggyecheon et dîner à proximité',
                        lieux: [
                            {
                                nom: 'Cheonggyecheon Stream',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Cheonggyecheon'
                            }
                        ],
                        transport: 'À pied'
                    }
                }
            },
            {
                id: '3',
                date: '2025-05-06',
                titre: 'Studios, Shopping et Nuit Présidentielle',
                activites: {
                    'Matin': {
                        texte: 'Visite des studios de dramas MBC',
                        lieux: [
                            {
                                nom: 'MBC Drama Studios',
                                kakaoMapUrl: 'https://map.kakao.com/?q=MBC%20Drama%20Studios',
                                notes: 'RDV: 8h30 - Hongik University Station Exit 3'
                            }
                        ],
                        transport: 'Ligne 2 - Station Hongik University, Sortie 3'
                    },
                    'Après-midi': {
                        texte: 'Café Kitsuné, COEX Mall (Starfield, KTOWN4U)',
                        lieux: [
                            {
                                nom: 'Café Kitsuné',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Cafe Kitsune Seoul'
                            },
                            {
                                nom: 'COEX Mall',
                                kakaoMapUrl: 'https://map.kakao.com/?q=COEX Mall Seoul'
                            }
                        ],
                        transport: 'Ligne 9 → Ligne 2'
                    },
                    'Soirée': {
                        texte: 'Visite nocture de Cheong Wa Dae et dîner à proximité',
                        lieux: [
                            {
                                nom: 'Cheong Wa Dae',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Cheong Wa Dae',
                                notes: 'RDV: 20h - Dernière admission 20h20 - Fermeture 21h00'
                            },
                            {
                                nom: 'Dîner à Seochon Village ou Jongno / Jonggak',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Seochon Village'
                            }
                        ],
                        transport: 'Ligne 2'
                    }
                }
            },
            {
                id: '4',
                date: '2025-05-07',
                titre: 'Nature et détente',
                activites: {
                    'Matin': {
                        texte: 'Promenade à Seoul Forest (arrêts Deer Corral et Butterfly Garden) + café 5to7 (fluffy pancakes)',
                        lieux: [
                            {
                                nom: 'Seoul Forest',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Seoul Forest'
                            },
                            {
                                nom: 'Café 5to7',
                                kakaoMapUrl: 'https://map.kakao.com/?q=5to7 Seoul Forest'
                            }
                        ],
                        transport: 'Ligne 2 - Station Ttukseom ou Ligne Bundang - Station Seoul Forest'
                    },
                    'Après-midi': {
                        texte: 'Randonnée à Eungbongsan Mountain avec Eungbong Mountain Park et Eungbongsan Palgakjeong Pavilion',
                        lieux: [
                            {
                                nom: 'Eungbongsan Mountain',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Eungbongsan Seoul'
                            }
                        ],
                        transport: 'Ligne 2 - Station Eungbong'
                    },
                    'Soirée': {
                        texte: 'Dîner jjimdak ou mandu à proximité',
                        lieux: [
                            {
                                nom: 'Restaurants autour de Seongsu',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Seongsu-dong Seoul'
                            }
                        ],
                        transport: 'Ligne 2'
                    }
                }
            },
            {
                id: '5',
                date: '2025-05-08',
                titre: 'Panoramas, Palais et Festival Étudiant',
                activites: {
                    'Matin': {
                        texte: 'Montée en Namsan Cable Car et profiter de la vue depuis la N Seoul Tower, puis visite du Namsangol Village',
                        lieux: [
                            {
                                nom: 'Namsan Cable Car',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Namsan Cable Car Seoul'
                            },
                            {
                                nom: 'N Seoul Tower',
                                kakaoMapUrl: 'https://map.kakao.com/?q=N Seoul Tower'
                            },
                            {
                                nom: 'Namsangol Hanok Village',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Namsangol Hanok Village'
                            }
                        ],
                        transport: 'Ligne 4 - Station Myeongdong ou Ligne 3 - Station Chungmuro'
                    },
                    'Après-midi': {
                        texte: 'Visite de Deoksugung Palace et Sungnyemun Gate',
                        lieux: [
                            {
                                nom: 'Deoksugung Palace',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Deoksugung Palace'
                            },
                            {
                                nom: 'Sungnyemun Gate',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Sungnyemun Gate'
                            },
                            {
                                nom: 'Café anniversaire pour Junghwa de EXID',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Sungnyemun Gate'
                            }
                        ],
                        transport: 'Ligne 1 - Station City Hall'
                    },
                    'Soirée': {
                        texte: 'Festival à l’Université Sungkyunkwan',
                        lieux: [
                            {
                                nom: '2025 성균관대학교 인문사회과학캠퍼스 대동제',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Nike Hongdae'
                            }
                        ],
                        transport: 'Ligne 2 - Station Hongik University',
                        notes: 'Événement café pour l\'anniversaire de Junghwa (EXID) - détails à confirmer'
                    }
                }
            },
            {
                id: '6',
                date: '2025-05-09',
                titre: 'Découverte culturelle et NELL',
                activites: {
                    'Matin': {
                        texte: 'Visite du Changdeokgung Palace avec la visite guidée du Jardin Secret (Huwon)',
                        lieux: [
                            {
                                nom: 'Changdeokgung Palace',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Changdeokgung Palace',
                                notes: 'RÉSERVATION LE 3 MAI À 3H'
                            }
                        ],
                        transport: 'Ligne 3 - Station Anguk, Sortie 3'
                    },
                    'Après-midi': {
                        texte: 'Doma Insadong et Artist Bakery',
                        lieux: [
                            {
                                nom: 'Doma Insadong (도마 인사동점)',
                                kakaoMapUrl: 'https://map.kakao.com/?q=도마 인사동점'
                            },
                            {
                                nom: 'Artist Bakery (아티스트 베이커리)',
                                kakaoMapUrl: 'https://map.kakao.com/?q=아티스트 베이커리'
                            }
                        ],
                        transport: 'À pied depuis Changdeokgung'
                    },
                    'Soirée': {
                        texte: 'NELL\'S SEASON 2025 \'Acoustic Concert 〈Still Sunset〉',
                        lieux: [
                            {
                                nom: 'Universal Arts Center',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Universal Arts Center Seoul',
                                notes: 'Concert à 20h - 1st floor Side C. Row 8. 7'
                            }
                        ],
                        transport: 'Ligne 6 - Station Achasan'
                    }
                }
            },
            {
                id: '7',
                date: '2025-05-10',
                titre: 'Histoire et détente',
                activites: {
                    'Matin': {
                        texte: 'Visite du War Memorial of Korea (et Statue Park)',
                        lieux: [
                            {
                                nom: 'War Memorial of Korea',
                                kakaoMapUrl: 'https://map.kakao.com/?q=War Memorial of Korea'
                            }
                        ],
                        transport: 'Ligne 4 ou 6 - Station Samgakji, Sortie 12'
                    },
                    'Après-midi': {
                        texte: 'Visite du Musée national de Corée et Yongsan Family Park',
                        lieux: [
                            {
                                nom: 'National Museum of Korea',
                                kakaoMapUrl: 'https://map.kakao.com/?q=National Museum of Korea'
                            },
                            {
                                nom: 'Yongsan Family Park',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Yongsan Family Park'
                            }
                        ],
                        transport: 'Ligne 4 - Station Ichon'
                    },
                    'Soirée': {
                        texte: 'Promenade Sebitseom et Banpodaegyo Bridge (jeux de lumière - côté Sud) et dîner',
                        lieux: [
                            {
                                nom: 'Sebitseom',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Sebitseom'
                            },
                            {
                                nom: 'Banpodaegyo Bridge',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Banpodaegyo Bridge'
                            }
                        ],
                        transport: 'Ligne 3 ou 7 - Station Express Bus Terminal'
                    }
                }
            },
            {
                id: '8',
                date: '2025-05-11',
                titre: 'Entre Mémoire et Nature : Seodaemun & Hongjecheon',
                activites: {
                    'Matin': {
                        texte: 'Randonnée Ansan Jarak-gil Trail et visite du Seodaemun Independence Park et Seodaemun Prison History Hall',
                        lieux: [
                            {
                                nom: 'Ansan Jarak-gil Trail',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Ansan Jarak-gil Trail'
                            },
                            {
                                nom: 'Seodaemun Prison History Hall',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Seodaemun Prison History Hall'
                            }
                        ],
                        transport: 'Ligne 3 - Station Dongnimmun, Sortie 5'
                    },
                    'Après-midi': {
                        texte: 'Visite des Hongjecheon Artificial Falls et détente au café Pokpo',
                        lieux: [
                            {
                                nom: 'Hongjecheon Artificial Falls',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Hongjecheon Artificial Falls'
                            },
                            {
                                nom: 'Café Pokpo',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Café Pokpo Seoul'
                            }
                        ],
                        transport: 'Ligne 3 - Station Hongje'
                    },
                    'Soirée': {
                        texte: 'Balade dans le quartier animé de Hongdae (Personnalisation Adidas, Nike, Converse Shop)',
                        lieux: [
                            {
                                nom: 'Nike Store',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Nike Hongdae'
                            },
                            {
                                nom: 'Adidas Store',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Nike Hongdae'
                            },
                            {
                                nom: 'Converse Store',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Nike Hongdae'
                            }
                        ],
                        transport: 'Ligne 2 - Station Hongik University',
                        notes: 'Événement café pour l\'anniversaire de Junghwa (EXID) - détails à confirmer'
                    }
                }
            },
            {
                id: '9',
                date: '2025-05-12',
                titre: 'Artisanat et Traditions Locales',
                activites: {
                    'Matin': {
                        texte: 'Cours cuisine de Kimchi et exploration du Hanok Village d\'Ikseon-dong',
                        lieux: [
                            {
                                nom: 'Kimchi Making Class',
                                adresse: '종로구 계동길 102',
                                kakaoMapUrl: 'https://map.kakao.com/?q=종로구 계동길 102',
                                notes: 'RDV: 9h15 à 10h15 - Phone : +82-2-318-7051'
                            },
                            {
                                nom: 'Ikseon-dong Hanok Village',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Ikseon-dong Hanok Village'
                            }
                        ],
                        transport: 'Ligne 1 ou 3 - Station Jongno 3-ga'
                    },
                    'Après-midi': {
                        texte: 'Activité Création sceau et exploration d\'Insadong Street ainsi que Ssamzigil Shopping Mall',
                        lieux: [
                            {
                                nom: 'Studio de création de sceaux',
                                adresse: '3rd fl, 55-1 Insadong-gil, Jongno-gu, Seoul, South Korea',
                                kakaoMapUrl: 'https://map.kakao.com/?q=3rd fl, 55-1 Insadong-gil, Jongno-gu, Seoul',
                                notes: 'RDV: 14h30'
                            },
                            {
                                nom: 'Insadong Street',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Insadong Street'
                            },
                            {
                                nom: 'Ssamzigil Shopping Mall',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Ssamzigil'
                            }
                        ],
                        transport: 'Ligne 3 - Station Anguk, Sortie 6'
                    },
                    'Soirée': {
                        texte: 'Bulgogi chez Insadong Hangane Bulgogi Jumak',
                        lieux: [
                            {
                                nom: 'Insadong Hangane Bulgogi Jumak',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Insadong Hangane Bulgogi Jumak'
                            }
                        ],
                        transport: 'À pied dans Insadong'
                    }
                }
            },
            {
                id: '10',
                date: '2025-05-13',
                titre: 'Shopping et Patrimoine Architectural',
                activites: {
                    'Matin': {
                        texte: 'Shopping au Dongdaemun Shopping Complex et éventuellement DDP',
                        lieux: [
                            {
                                nom: 'Dongdaemun Shopping Complex',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Dongdaemun Shopping Complex'
                            },
                            {
                                nom: 'Dongdaemun Design Plaza (DDP)',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Dongdaemun Design Plaza'
                            }
                        ],
                        transport: 'Ligne 2 ou 4 - Station Dongdaemun History & Culture Park'
                    },
                    'Après-midi': {
                        texte: 'Pause au café Onion Anguk et visite de Changgyeonggung Palace',
                        lieux: [
                            {
                                nom: 'Café Onion Anguk',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Café Onion Anguk'
                            },
                            {
                                nom: 'Changgyeonggung Palace',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Changgyeonggung Palace'
                            }
                        ],
                        transport: 'Ligne 3 - Station Anguk'
                    },
                    'Soirée': {
                        texte: 'Visite à pied des joyaux cachés de la nuit',
                        lieux: [
                            {
                                nom: 'Hyehwa Station, Sortie 2',
                                adresse: '120 Daehak-ro, Jongno-gu, Seoul, South Korea',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Hyehwa Station Exit 2',
                                notes: 'RDV: 18h15 - Un guide vous attendra à l\'extérieur de la sortie 2'
                            }
                        ],
                        transport: 'Ligne 4 - Station Hyehwa'
                    }
                }
            },
            {
                id: '11',
                date: '2025-05-14',
                titre: 'Ambiance Universitaire et Music Show',
                activites: {
                    'Matin': {
                        texte: 'Découverte des campus de Yonsei et Hongik University',
                        lieux: [
                            {
                                nom: 'Yonsei University',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Yonsei University'
                            },
                            {
                                nom: 'Hongik University',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Hongik University'
                            }
                        ],
                        transport: 'Ligne 2 - Station Hongik University / Ligne 2 - Station Sinchon'
                    },
                    'Après-midi': {
                        texte: 'Show Champion',
                        lieux: [
                            {
                                nom: 'Starbucks Goyang',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Starbucks Goyang',
                                notes: 'RDV: 15h00'
                            }
                        ],
                        transport: 'Ligne 3 - Direction Goyang'
                    },
                    'Soirée': {
                        texte: 'Shopping Myeongdong (Underground, exit 6 K-Pop) et Myeongdong Night Market',
                        lieux: [
                            {
                                nom: 'Myeongdong Shopping Street',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Myeongdong Shopping Street'
                            },
                            {
                                nom: 'Myeongdong Night Market',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Myeongdong Night Market'
                            }
                        ],
                        transport: 'Ligne 4 - Station Myeongdong'
                    }
                }
            },
            {
                id: '12',
                date: '2025-05-15',
                titre: 'Journée Récréative et Panoramique',
                activites: {
                    'Matin': {
                        texte: 'Visite Lotte World Aquarium, puis vue panoramique depuis la Lotte World Tower Séoul SKY',
                        lieux: [
                            {
                                nom: 'Lotte World Aquarium',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Lotte World Aquarium'
                            },
                            {
                                nom: 'Lotte World Tower Seoul SKY',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Lotte World Tower Seoul SKY'
                            }
                        ],
                        transport: 'Ligne 2 - Station Jamsil'
                    },
                    'Après-midi': {
                        texte: 'Suite de la visite et préparation pour la soirée',
                        lieux: [
                            {
                                nom: 'Lotte World Mall',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Lotte World Mall'
                            }
                        ],
                        transport: 'À pied'
                    },
                    'Soirée': {
                        texte: 'Gyeongbokgung Palace Starlight Night Tour, puis visite du Lac de Seokchon',
                        lieux: [
                            {
                                nom: 'Gyeongbokgung Palace',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Gyeongbokgung Palace',
                                notes: 'RDV: 18h20 - In front of Gyejodang Information Desk - Guide en anglais'
                            },
                            {
                                nom: 'Lac de Seokchon',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Seokchon Lake'
                            }
                        ],
                        transport: 'Ligne 3 - Station Gyeongbokgung'
                    }
                }
            },
            {
                id: '13',
                date: '2025-05-16',
                titre: 'Journée Baseball, Brunch et Home Run !',
                activites: {
                    'Matin': {
                        texte: 'Brunch au Maple Top Pancake Club',
                        lieux: [
                            {
                                nom: 'Maple Top Pancake Club',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Maple Top Pancake Club'
                            }
                        ],
                        transport: 'À déterminer selon emplacement'
                    },
                    'Après-midi': {
                        texte: 'Visite du Songpa Book Museum, si le temps le permet ARC·N·BOOK (4F Lotte World Mall)',
                        lieux: [
                            {
                                nom: 'Songpa Book Museum',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Songpa Book Museum'
                            },
                            {
                                nom: 'ARC·N·BOOK',
                                kakaoMapUrl: 'https://map.kakao.com/?q=ARC N BOOK Lotte World Mall'
                            },
                            {
                                nom: 'Café anniversaire pour IU',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Sungnyemun Gate'
                            }
                        ],
                        transport: 'Ligne 2 - Station Jamsil',
                        notes: 'Événement café pour l\'anniversaire de IU - détails à confirmer'
                    },
                    'Soirée': {
                        texte: 'Match de Baseball LG Twins vs KT Wiz',
                        lieux: [
                            {
                                nom: 'Jamsil Baseball Stadium',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Jamsil Baseball Stadium',
                                notes: 'RDV: 16h'
                            }
                        ],
                        transport: 'Ligne 2 - Station Sports Complex'
                    }
                }
            },
            {
                id: '14',
                date: '2025-05-17',
                titre: 'Pause Verte et Découvertes',
                activites: {
                    'Matin': {
                        texte: 'Découverte du The Space Filled With You (Lettre à ton futur toi)',
                        lieux: [
                            {
                                nom: 'The Space Filled With You',
                                kakaoMapUrl: 'https://map.kakao.com/?q=The Space Filled With You Seoul'
                            }
                        ],
                        transport: 'À déterminer selon emplacement'
                    },
                    'Après-midi': {
                        texte: 'Promenade au Namsan Outdoor Botanical Garden',
                        lieux: [
                            {
                                nom: 'Namsan Outdoor Botanical Garden',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Namsan Botanical Garden'
                            },
                            {
                                nom: 'Café anniversaire pour JiU de DREAMCATCHER',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Sungnyemun Gate'
                            }
                        ],
                        transport: 'Ligne 4 - Station Myeongdong puis navette'
                    },
                    'Soirée': {
                        texte: 'Poulet frit coréen au Kyochon Pilbang et shopping à Itaewon',
                        lieux: [
                            {
                                nom: 'Kyochon Pilbang',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Kyochon Itaewon'
                            },
                            {
                                nom: 'Itaewon Shopping Street',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Itaewon Shopping Street'
                            }
                        ],
                        transport: 'Ligne 6 - Station Itaewon',
                        notes: 'Événement café pour l\'anniversaire de JiU (Dreamcatcher) - détails à confirmer'
                    }
                }
            },
            {
                id: '15',
                date: '2025-05-18',
                titre: 'Attractions Insolites et Divertissement',
                activites: {
                    'Matin': {
                        texte: 'Visite du 943 King\'s Cross café, ambiance Harry Potter',
                        lieux: [
                            {
                                nom: '943 King\'s Cross Café',
                                kakaoMapUrl: 'https://map.kakao.com/?q=943 Kings Cross'
                            }
                        ],
                        transport: 'Ligne 2 - Station Hongdae'
                    },
                    'Après-midi': {
                        texte: 'Bonobo café + chill Hongdae',
                        lieux: [
                            {
                                nom: 'Bonobo Café',
                                adresse: '서울 마포구 와우산로29마길 15, 2층',
                                kakaoMapUrl: 'https://map.kakao.com/?q=서울 마포구 와우산로29마길 15, 2층',
                                notes: 'Situé près de la sortie 7 de la station de métro Hongik University, c\'est un excellent café à thème DIY ! Dans ce café de coques de téléphone, vous pouvez choisir parmi une variété incroyable de breloques et de gelées colorées pour décorer un étui transparent.'
                            },
                            {
                                nom: 'Hongdae Area',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Hongdae Seoul'
                            }
                        ],
                        transport: 'Ligne 2 - Station Hongik University, Sortie 7'
                    },
                    'Soirée': {
                        texte: 'Concert BIBI - Olympic Hall',
                        lieux: [
                            {
                                nom: 'Olympic Hall',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Olympic Hall Seoul',
                                notes: 'Début: 17h - Seat FLOOR Da. Row 4. 12'
                            }
                        ],
                        transport: 'Ligne 5 - Station Olympic Park'
                    }
                }
            },
            {
                id: '16',
                date: '2025-05-19',
                titre: 'Parcs et Expériences Locales',
                activites: {
                    'Matin': {
                        texte: 'Balade en vélo - Han River',
                        lieux: [
                            {
                                nom: 'Jayang Station Exit 2',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Jayang Station Exit 2',
                                notes: 'RDV: 9h15'
                            }
                        ],
                        transport: 'Ligne 5 - Station Jayang, Sortie 2'
                    },
                    'Après-midi': {
                        texte: 'Visite d\'Eunpyeong Hanok Village ainsi que le temple Jingwansa',
                        lieux: [
                            {
                                nom: 'Eunpyeong Hanok Village',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Eunpyeong Hanok Village'
                            },
                            {
                                nom: 'Temple Jingwansa',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Jingwansa Temple'
                            }
                        ],
                        transport: 'Ligne 3 - Station Gupabal puis bus'
                    },
                    'Soirée': {
                        texte: 'Café - 1인1상 puis dîner au Yeonseo Market',
                        lieux: [
                            {
                                nom: 'Café 1인1상',
                                kakaoMapUrl: 'https://map.kakao.com/?q=1인1상 Seoul'
                            },
                            {
                                nom: 'Yeonseo Market',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Yeonseo Market'
                            }
                        ],
                        transport: 'Ligne 6 - Station Yeonsinnae'
                    }
                }
            },
            {
                id: '17',
                date: '2025-05-20',
                titre: 'Nature et Design Contemporain',
                activites: {
                    'Matin': {
                        texte: 'Visite du Bukhansan National Park avec ascension sommet Baegundae',
                        lieux: [
                            {
                                nom: 'Bukhansan National Park',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Bukhansan National Park'
                            },
                            {
                                nom: 'Baegundae Peak',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Baegundae Peak'
                            }
                        ],
                        transport: 'Ligne 3 - Station Gupabal, puis bus 704'
                    },
                    'Après-midi': {
                        texte: 'Relaxation et visite du Doseonsa Temple',
                        lieux: [
                            {
                                nom: 'Doseonsa Temple',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Doseonsa Temple'
                            }
                        ],
                        transport: 'À pied depuis Bukhansan'
                    },
                    'Soirée': {
                        texte: 'Dîner chez Tosokchon Samgyetang',
                        lieux: [
                            {
                                nom: 'Tosokchon Samgyetang',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Tosokchon Samgyetang'
                            }
                        ],
                        transport: 'Ligne 3 - Station Gyeongbokgung'
                    }
                }
            },
            {
                id: '18',
                date: '2025-05-21',
                titre: 'Départ',
                activites: {
                    'Matin': {
                        texte: 'Préparation au départ et derniers achats',
                        lieux: [
                            {
                                nom: 'Airbnb',
                                adresse: '서울 영등포구 영등포로3길 23 코업레지던스 오목교 1123호 (07276)',
                                kakaoMapUrl: 'https://map.kakao.com/?q=서울 영등포구 영등포로3길 23 코업레지던스 오목교 1123호'
                            }
                        ],
                        transport: 'N/A'
                    },
                    'Après-midi': {
                        texte: 'Départ vers l\'aéroport',
                        lieux: [
                            {
                                nom: 'Incheon International Airport',
                                kakaoMapUrl: 'https://map.kakao.com/?q=Incheon International Airport'
                            }
                        ],
                        transport: 'AREX Express ou KAL Limousine'
                    }
                }
            }
        ];
        // État de l'application
        let currentView = 'home';
        let selectedDay = null;
        let activitiesCompleted = {};
        let currentPosition = null; // Pour stocker la position géographique actuelle
        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            initGeolocation();
        });
        function initApp() {
            // Charger les données sauvegardées
            loadSavedData();
            // Afficher les jours sur la page d'accueil
            renderDaysView();
            // Configurer les écouteurs d'événements
            document.getElementById('searchButton').addEventListener('click', toggleSearchBar);
            document.getElementById('toggleNotdone').addEventListener('click', function() {
                toggleNotdone();
            });
            document.getElementById('search-input').addEventListener('input', performSearch);
            const locBtn = document.getElementById('get-location-btn');
            if (locBtn) locBtn.addEventListener('click', getUserLocation);
            document.getElementById('btn-home').addEventListener('click', function() {
                const dayDetail = document.getElementById('day-detail-view');
                if(dayDetail) dayDetail.classList.add('hidden');
                const mapView = document.getElementById('map-view');
                if(mapView) mapView.classList.add('hidden');
                const notdoneView = document.getElementById('notdone-view');
                if(notdoneView) notdoneView.classList.add('hidden');
                const settingsView = document.getElementById('settings-view');
                if(settingsView) settingsView.classList.add('hidden');
                const homeView = document.getElementById('home-view');
                if(homeView) homeView.classList.remove('hidden');
                updateActiveNavigation('home');
            });
            document.getElementById('btn-notdone').addEventListener('click', toggleNotdone);
            // Initialiser le cercle de progression
            updateProgressCircle();
            // Calculer et afficher le nombre total de lieux
            updateTotalPlaces();
            // Initialiser le mode sombre
            initDarkMode();
            // Générer la timeline
            renderTimeline();
            // Ajouter un eventListener sur le lien Accueil du fil d'Ariane
            document.getElementById('breadcrumb-home').addEventListener('click', function() {
                const dayDetail = document.getElementById('day-detail-view');
                if(dayDetail) dayDetail.classList.add('hidden');
                const homeView = document.getElementById('home-view');
                if(homeView) homeView.classList.remove('hidden');
                // Réinitialiser le breadcrumb
                document.getElementById('breadcrumb-home').classList.add('active');
                document.getElementById('breadcrumb-separator').classList.add('hidden');
                document.getElementById('breadcrumb-day').classList.add('hidden');
                document.getElementById('breadcrumb-day').classList.remove('active');
                // Rafraîchir la home (jours + timeline)
                renderDaysView();
                renderTimeline();
                updateCompletionRate();
                updateTotalPlaces && updateTotalPlaces();
                updateActiveNavigation('home');
            });
        }
        function initGeolocation() {
            // Écouteur pour le bouton de localisation
            const locationBtn = document.getElementById('get-location-btn');
            if (locationBtn) {
                locationBtn.addEventListener('click', getUserLocation);
            }
            // Écouteur pour le curseur de distance
            const distanceRange = document.getElementById('distance-range');
            if (distanceRange) {
                distanceRange.addEventListener('input', function() {
                    document.getElementById('distance-value').textContent = this.value + ' km';
                    // Si nous avons déjà une position, mettre à jour les résultats
                    if (currentPosition) {
                        findNotdoneActivities();
                    }
                });
            }
        }
        function initDarkMode() {
            const darkModeToggle = document.getElementById('toggle-dark-mode');
            if (darkModeToggle) {
                // Vérifier si le mode sombre est déjà activé
                const darkMode = localStorage.getItem('darkMode') === 'true';
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                    darkModeToggle.classList.add('bg-indigo-600');
                    const dot = darkModeToggle.querySelector('span');
                    if (dot) {
                        dot.classList.remove('translate-x-1');
                        dot.classList.add('translate-x-6');
                    }
                }
                // Ajouter l'écouteur d'événement
                darkModeToggle.addEventListener('click', function() {
                    this.classList.toggle('bg-indigo-600');
                    const dot = this.querySelector('span');
                    if (dot && dot.classList.contains('translate-x-1')) {
                        // Activer le mode sombre
                        dot.classList.remove('translate-x-1');
                        dot.classList.add('translate-x-6');
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('darkMode', 'true');
                    } else {
                        // Désactiver le mode sombre
                        dot.classList.remove('translate-x-6');
                        dot.classList.add('translate-x-1');
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('darkMode', 'false');
                    }
                });
            }
            const resetCheckmarks = document.getElementById('reset-checkmarks');
            if (resetCheckmarks) {
                resetCheckmarks.addEventListener('click', function() {
                    if (confirm('Êtes-vous sûr de vouloir réinitialiser toutes les activités cochées ?')) {
                        activitiesCompleted = {};
                        localStorage.setItem('activitiesCompleted', JSON.stringify(activitiesCompleted));
                        updateCompletionRate();
                        renderDaysView();
                        alert('Toutes les activités ont été réinitialisées.');
                    }
                });
            }
        }
        function loadSavedData() {
            // Charger les activités complétées
            const savedActivities = localStorage.getItem('activitiesCompleted');
            if (savedActivities) {
                activitiesCompleted = JSON.parse(savedActivities);
            }
            // Vérifier si le mode sombre est activé
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                // Mettre à jour le bouton du mode sombre
                const darkModeToggle = document.getElementById('toggle-dark-mode');
                if (darkModeToggle) {
                    darkModeToggle.classList.add('bg-indigo-600');
                    const dot = darkModeToggle.querySelector('span');
                    if (dot) {
                        dot.classList.remove('translate-x-1');
                        dot.classList.add('translate-x-6');
                    }
                }
            }
            // Calculer et afficher le taux de progression
            updateCompletionRate();
        }
        function renderDaysView() {
            const container = document.getElementById('days-container');
            container.innerHTML = '';
            // Trier les jours par date
            const sortedDays = [...itineraireSeoul].sort((a, b) => new Date(a.date) - new Date(b.date));
            sortedDays.forEach(day => {
                const date = new Date(day.date);
                const formattedDate = date.toLocaleDateString('fr-FR', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'short'
                });
                // Calculer le nombre d'activités complétées pour ce jour
                const totalActivities = Object.keys(day.activites).length;
                const completedActivities = Object.keys(day.activites).filter(moment => 
                    activitiesCompleted[`${day.id}-${moment}`]).length;
                // Masquer la tuile si toutes les activités sont complétées (progression 100%)
                if (totalActivities > 0 && completedActivities === totalActivities) {
                    return;
                }
                const card = document.createElement('div');
                card.className = 'day-card bg-white rounded-lg shadow-md p-4 relative transition-all duration-300 hover:shadow-lg dark:bg-gray-800';
                card.setAttribute('data-day-id', day.id);
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">${formattedDate}</div>
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">${day.titre}</h3>
                            <div class="flex items-center mt-2">
                                <div class="bg-gray-200 rounded-full h-2 w-24 mr-2 dark:bg-gray-700">
                                    <div class="bg-indigo-600 rounded-full h-2" style="width: ${(completedActivities/totalActivities) * 100}%;"></div>
                                </div>
                                <span class="text-xs text-gray-600 dark:text-gray-400">${completedActivities}/${totalActivities}</span>
                            </div>
                            <div class="mt-2 space-x-1">
                                ${Object.keys(day.activites).map(moment => 
                                    `<span class="location-badge ${activitiesCompleted[`${day.id}-${moment}`] ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'}"><span>${moment}</span></span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
                // Ajouter un écouteur d'événement sur la carte
                card.addEventListener('click', () => showDayDetail(day.id));
            });
        }
        function showDayDetail(dayId) {
    // Trouver le jour sélectionné
    const day = itineraireSeoul.find(d => d.id === dayId);
    if (!day) return;
            selectedDay = day;
            currentView = 'day-detail';
            // Mettre à jour le fil d'Ariane
            updateBreadcrumb(day);
            // Afficher la vue détail et cacher la home
            const detailView = document.getElementById('day-detail-view');
            const homeView = document.getElementById('home-view');
            if (detailView && homeView) {
                detailView.classList.remove('hidden');
                homeView.classList.add('hidden');
                detailView.innerHTML = '';
            } else {
                // Sécurité : log si l'un des éléments n'existe pas
                if (!detailView) console.error("L'élément #day-detail-view est introuvable dans le DOM");
                if (!homeView) console.error("L'élément #home-view est introuvable dans le DOM");
                return;
            }
    // Synchroniser l'état des boutons et labels après rendu
    setTimeout(syncLieuButtonsUI, 0);
    // Récupérer l'ordre chronologique
    const sortedDays = [...itineraireSeoul].sort((a, b) => new Date(a.date) - new Date(b.date));
            const currentIndex = sortedDays.findIndex(d => d.id === day.id);
            const prevDay = currentIndex > 0 ? sortedDays[currentIndex - 1] : null;
            const nextDay = currentIndex < sortedDays.length - 1 ? sortedDays[currentIndex + 1] : null;
            // Créer la barre de navigation
            const navDiv = document.createElement('div');
            navDiv.className = 'flex items-center w-full mb-5';
            navDiv.innerHTML = `
  <div class="flex-1 flex justify-start">
    <button id="prev-day-btn" class="flex items-center px-3 py-2 rounded-lg text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900 hover:bg-indigo-100 dark:hover:bg-indigo-800 font-semibold shadow-sm border dark:border-gray-700 transition" ${prevDay ? '' : 'disabled style=\'opacity:0.4;pointer-events:none\''}>
      <i class="fas fa-chevron-left mr-2"></i>
      ${prevDay ? `<span>${new Date(prevDay.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}</span>` : '<span>Début</span>'}
    </button>
  </div>
  <div class="flex-none text-center w-auto">
    <span class="text-lg font-bold text-gray-800 dark:text-white">Jour ${currentIndex + 1} / ${sortedDays.length}</span>
  </div>
  <div class="flex-1 flex justify-end">
    <button id="next-day-btn" class="flex items-center px-3 py-2 rounded-lg text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900 hover:bg-indigo-100 dark:hover:bg-indigo-800 font-semibold shadow-sm border dark:border-gray-700 transition" ${nextDay ? '' : 'disabled style=\'opacity:0.4;pointer-events:none\''}>
      ${nextDay ? `<span>${new Date(nextDay.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}</span>` : '<span>Fin</span>'}
      <i class="fas fa-chevron-right ml-2"></i>
    </button>
  </div>
`;
            detailView.appendChild(navDiv);
            // Ajout des écouteurs
            if (prevDay) navDiv.querySelector('#prev-day-btn').addEventListener('click', () => showDayDetail(prevDay.id));
            if (nextDay) navDiv.querySelector('#next-day-btn').addEventListener('click', () => showDayDetail(nextDay.id));
            const date = new Date(day.date);
            const formattedDate = date.toLocaleDateString('fr-FR', {
                weekday: 'long',
                day: 'numeric',
                month: 'long'
            });
            // En-tête avec la date
            const header = document.createElement('div');
            header.className = 'bg-white p-5 rounded-lg shadow-md mb-4 dark:bg-gray-800';
            header.innerHTML = `
                <div class="text-sm text-gray-500 dark:text-gray-400">${formattedDate}</div>
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">${day.titre}</h2>
            `;
            detailView.appendChild(header);
            // Activités par moment de la journée
            Object.entries(day.activites).forEach(([moment, details]) => {
                const activityId = `${day.id}-${moment}`;
                const isCompleted = activitiesCompleted[activityId] || false;
                const activityCard = document.createElement('div');
                activityCard.className = `bg-white p-5 rounded-lg shadow-md mb-4 ${isCompleted ? 'border-l-4 border-green-500' : ''} dark:bg-gray-800`;
                let activityContent = `
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-white">${moment}</h3>
                        <button onclick="toggleActivityCompletion('${activityId}')" class="w-6 h-6 rounded-full flex items-center justify-center ${isCompleted ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}">
                            ${isCompleted ? '<i class="fas fa-check text-xs"></i>' : ''}
                        </button>
                    </div>
                    <p class="${isCompleted ? 'checked-activity' : ''} text-gray-700 dark:text-gray-300">${details.texte}</p>
                `;
                // Ajouter les lieux si présents
                if (details.lieux && details.lieux.length > 0) {
                    activityContent += `<div class="mt-3 space-y-2">`;
                    details.lieux.forEach((lieu, lieuIdx) => {
                        const lieuId = `${day.id}-${moment}-${lieuIdx}`;
                        const isLieuCompleted = activitiesCompleted[lieuId] || false;
                        activityContent += `
                            <div class="flex items-center bg-gray-50 p-3 rounded-lg dark:bg-gray-700 dark:border dark:border-gray-600">
                                <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                                <div>
                                    <div id="lieu-nom-${lieuId}" class="font-medium text-gray-800 dark:text-gray-200${isLieuCompleted ? ' checked-lieu' : ''}">${lieu.nom}</div>
                                    ${lieu.adresse ? `<div class="text-xs text-gray-600 dark:text-gray-400">${lieu.adresse}</div>` : ''}
                                    ${lieu.notes ? `<div class="text-xs text-blue-600 mt-1 dark:text-blue-400">${lieu.notes}</div>` : ''}
                                </div>
                                <div class="ml-auto flex items-center space-x-2">
                                    <button id="btn-lieu-${lieuId}" class="mark-done-btn rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-opacity-50 ${isLieuCompleted ? 'completed' : ''}" onclick="toggleLieuCompletionInstant('${lieuId}'); event.stopPropagation();">
                                        ${isLieuCompleted ? '<i class="fas fa-check mr-1"></i> Fait' : '<i class="far fa-circle mr-1"></i> Non fait'}
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    activityContent += `</div>`;
                }
                activityCard.innerHTML = activityContent;
                detailView.appendChild(activityCard);
            });
            // Masquer la vue d'accueil et afficher la vue détaillée
            document.getElementById('home-view').classList.add('hidden');
            const mapView = document.getElementById('map-view');
            if(mapView) mapView.classList.add('hidden');
            const notdoneView = document.getElementById('notdone-view');
            if(notdoneView) notdoneView.classList.add('hidden');
            const settingsView = document.getElementById('settings-view');
            if(settingsView) settingsView.classList.add('hidden');
            detailView.classList.remove('hidden');
        }
        function updateBreadcrumb(day) {
            const breadcrumbHome = document.getElementById('breadcrumb-home');
            const breadcrumbSeparator = document.getElementById('breadcrumb-separator');
            const breadcrumbDay = document.getElementById('breadcrumb-day');
            breadcrumbHome.classList.remove('active');
            breadcrumbSeparator.classList.remove('hidden');
            breadcrumbDay.classList.remove('hidden');
            breadcrumbDay.classList.add('active');
            const date = new Date(day.date);
            breadcrumbDay.textContent = date.toLocaleDateString('fr-FR', {
                day: 'numeric',
                month: 'short'
            }) + ' - ' + day.titre;
        }
        function toggleActivityCompletion(activityId) {
    // Inverser l'état d'achèvement
    activitiesCompleted[activityId] = !activitiesCompleted[activityId];
    // Trouver l'activité et ses lieux pour cocher/décocher tous les lieux associés
    if (selectedDay && activityId.includes('-')) {
        const [dayId, ...momentParts] = activityId.split('-');
        const moment = momentParts.join('-');
        const day = itineraireSeoul.find(d => d.id == dayId);
        if (day && day.activites[moment] && Array.isArray(day.activites[moment].lieux)) {
            day.activites[moment].lieux.forEach((lieu, lieuIdx) => {
                const lieuId = `${dayId}-${moment}-${lieuIdx}`;
                activitiesCompleted[lieuId] = activitiesCompleted[activityId];
            });
        }
    }
    // Sauvegarder l'état dans le localStorage
    localStorage.setItem('activitiesCompleted', JSON.stringify(activitiesCompleted));
    // Si nous sommes dans la vue détaillée, mettre à jour l'affichage
    if (currentView === 'day-detail' && selectedDay) {
        showDayDetail(selectedDay.id);
    }
    // Mettre à jour la page d'accueil
    renderDaysView();
    // Mettre à jour le taux de progression
    updateCompletionRate();
}
        function updateCompletionRate() {
            // Compter le nombre total d'activités
            let totalActivities = 0;
            let completedActivities = 0;
            itineraireSeoul.forEach(day => {
                const moments = Object.keys(day.activites);
                totalActivities += moments.length;
                moments.forEach(moment => {
                    if (activitiesCompleted[`${day.id}-${moment}`]) {
                        completedActivities++;
                    }
                });
            });
            // Calculer et afficher le pourcentage
            const completionRate = totalActivities > 0 ? Math.round((completedActivities / totalActivities) * 100) : 0;
            const completionElem = document.getElementById('completion-rate');
            if (completionElem) completionElem.textContent = completionRate + '%';
            // Mettre à jour le cercle de progression
            updateProgressCircle(completionRate);
        }
        function updateProgressCircle(rate = 0) {
            const circle = document.getElementById('progress-circle');
            if (circle) {
                const radius = circle.getAttribute('r');
                const circumference = 2 * Math.PI * radius;
                circle.setAttribute('stroke-dasharray', circumference);
                const offset = circumference - (rate / 100) * circumference;
                circle.setAttribute('stroke-dashoffset', offset);
            }
        }
        function updateTotalPlaces() {
            let totalPlaces = 0;
            // Compter tous les lieux dans l'itinéraire
            itineraireSeoul.forEach(day => {
                Object.values(day.activites).forEach(activity => {
                    if (activity.lieux) {
                        totalPlaces += activity.lieux.length;
                    }
                });
            });
            // Mettre à jour l'affichage
            const totalPlacesElem = document.getElementById('total-places');
            if (totalPlacesElem) {
                totalPlacesElem.textContent = totalPlaces;
            }
        }
        function toggleNotdone() {
    // Cacher toutes les vues (vérifier existence)
    const views = ['home-view', 'day-detail-view', 'map-view', 'settings-view'];
    views.forEach(id => {
        const el = document.getElementById(id);
        if (el && el.classList) el.classList.add('hidden');
    });
    const notdoneView = document.getElementById('notdone-view');
    if (notdoneView) {
        notdoneView.classList.remove('hidden');
    }
    // Mettre à jour la navigation active
    updateActiveNavigation('notdone');
    // Réinitialise le breadcrumb
    const breadcrumbHome = document.getElementById('breadcrumb-home');
    const breadcrumbSeparator = document.getElementById('breadcrumb-separator');
    const breadcrumbDay = document.getElementById('breadcrumb-day');
    if (breadcrumbHome && breadcrumbSeparator && breadcrumbDay) {
        breadcrumbHome.classList.add('active');
        breadcrumbSeparator.classList.add('hidden');
        breadcrumbDay.classList.add('hidden');
        breadcrumbDay.classList.remove('active');
    }
    // Affiche la liste des activités non réalisées
    findNotdoneActivities();
}
        function getUserLocation() {
            const statusDiv = document.getElementById('location-status');
            if (!navigator.geolocation) {
                statusDiv.innerHTML = `
                    <div class="bg-red-50 text-red-600 rounded-lg flex items-start dark:bg-red-900 dark:text-red-300 p-3">
                        <i class="fas fa-exclamation-circle mt-1 mr-2"></i>
                        <div>
                            <p class="font-medium">Géolocalisation non prise en charge</p>
                            <p class="text-sm">Votre navigateur ne supporte pas la géolocalisation.</p>
                        </div>
                    </div>
                `;
                return;
            }
            // Mettre à jour le statut
            statusDiv.innerHTML = `
                <div class="bg-yellow-50 text-yellow-700 rounded-lg flex items-start dark:bg-yellow-900 dark:text-yellow-300 p-3">
                    <i class="fas fa-sync-alt fa-spin mt-1 mr-2"></i>
                    <div>
                        <p class="font-medium">Localisation en cours...</p>
                        <p class="text-sm">Nous déterminons votre position actuelle.</p>
                    </div>
                </div>
            `;
            // Obtenir la position
            navigator.geolocation.getCurrentPosition(
                // Succès
                position => {
                    currentPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    statusDiv.innerHTML = `
                        <div class="bg-green-50 text-green-700 rounded-lg flex items-start dark:bg-green-900 dark:text-green-300 p-3">
                            <i class="fas fa-check-circle mt-1 mr-2"></i>
                            <div>
                                <p class="font-medium">Position détectée</p>
                                <p class="text-sm">Latitude: ${currentPosition.lat.toFixed(6)}, Longitude: ${currentPosition.lng.toFixed(6)}</p>
                            </div>
                        </div>
                    `;
                    // Trouver les activités à proximité
                    findNotdoneActivities();
                },
                // Erreur
                error => {
                    let errorMessage = "Une erreur est survenue lors de la géolocalisation.";
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = "Vous avez refusé l'accès à votre position.";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = "Votre position est actuellement indisponible.";
                            break;
                        case error.TIMEOUT:
                            errorMessage = "La demande de géolocalisation a expiré.";
                            break;
                    }
                    statusDiv.innerHTML = `
                        <div class="bg-red-50 text-red-600 rounded-lg flex items-start dark:bg-red-900 dark:text-red-300 p-3">
                            <i class="fas fa-exclamation-circle mt-1 mr-2"></i>
                            <div>
                                <p class="font-medium">Erreur de localisation</p>
                                <p class="text-sm">${errorMessage}</p>
                            </div>
                        </div>
                    `;
                },
                // Options
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
        function findNotdoneActivities() {
    const container = document.getElementById('notdone-places');
    if (!container) return;
    container.innerHTML = '';
    // Récupérer toutes les activités non réalisées (non cochées)
    let totalNotDone = 0;
    // Regrouper les activités non faites par jour
    itineraireSeoul.forEach(day => {
        // Récupérer les moments non cochés pour ce jour
        const momentsNotDone = Object.entries(day.activites).filter(([moment, details]) => {
            const activityId = `${day.id}-${moment}`;
            return !activitiesCompleted[activityId];
        });
        if (momentsNotDone.length > 0) {
            // Titre du jour
            const dayHeader = document.createElement('div');
            dayHeader.className = 'font-bold text-lg text-indigo-700 dark:text-indigo-300 mt-6 mb-2 flex items-center';
            dayHeader.innerHTML = `<i class='fas fa-calendar-day mr-2'></i>${new Date(day.date).toLocaleDateString('fr-FR', { weekday: 'long', day: '2-digit', month: 'short' })} — ${day.titre}`;
            container.appendChild(dayHeader);
            // Afficher chaque activité non faite de ce jour
            momentsNotDone.forEach(([moment, details]) => {
                const activityId = `${day.id}-${moment}`;
                // On affiche l'activité si elle-même non cochée OU au moins un lieu non coché
                let lieuxHtml = '';
                if (details.lieux && details.lieux.length > 0) {
                    lieuxHtml += `<div class='mt-2 ml-2 space-y-1'>`;
                    details.lieux.forEach((lieu, lieuIdx) => {
                        const lieuId = `${day.id}-${moment}-${lieuIdx}`;
                        const isLieuDone = activitiesCompleted[lieuId];
                        lieuxHtml += `<div class='flex items-center gap-2'>`;
                        if (isLieuDone) {
                            lieuxHtml += `<span class='location-badge bg-green-100 text-green-600 dark:bg-green-800 dark:text-green-200'><i class='fas fa-check-circle mr-1'></i><span class='line-through opacity-70'>${lieu.nom}</span></span>`;
                        } else {
                            lieuxHtml += `<button onclick="toggleLieuCompletionInstant('${lieuId}')" class="location-badge bg-gray-200 hover:bg-green-200 dark:bg-gray-700 dark:hover:bg-green-900"><i class='fas fa-circle mr-1 text-gray-400'></i>${lieu.nom}</button>`;
                        }
                        if (lieu.adresse) lieuxHtml += `<span class='text-xs text-gray-500 ml-2'>${lieu.adresse}</span>`;
                        lieuxHtml += `</div>`;
                    });
                    lieuxHtml += `</div>`;
                }
                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-lg shadow mb-4 dark:bg-gray-800';
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">Non réalisée</span>
                    </div>
                    <div class="mb-1 font-semibold text-gray-800 dark:text-white">${moment}</div>
                    <div class="text-gray-700 dark:text-gray-300 mb-2">${details.texte}</div>
                    ${lieuxHtml}
                `;
                container.appendChild(card);
                totalNotDone++;
            });
        }
    });
    if (totalNotDone === 0) {
        container.innerHTML = `<div class='text-center text-gray-500 dark:text-gray-300 py-8'>Toutes les activités ont été réalisées ! 🎉</div>`;
    }
    return;
    // --- Ancienne logique (supprimée) ---
    // Obtenir la distance maximale depuis le curseur
    // const maxDistance = parseFloat(document.getElementById('distance-range').value);
    // Liste pour stocker les activités à proximité
    // const notdoneActivities = [];
    // Date actuelle
    // const currentDate = new Date();
    // currentDate.setHours(0, 0, 0, 0);
    // Fonction de calcul de distance haversine
    function haversine(lat1, lng1, lat2, lng2) {
        function toRad(x) { return x * Math.PI / 180; }
        const R = 6371; // Rayon de la Terre en km
        const dLat = toRad(lat2 - lat1);
        const dLng = toRad(lng2 - lng1);
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                  Math.sin(dLng/2) * Math.sin(dLng/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }
    // Parcourir tous les jours et activités
    itineraireSeoul.forEach(day => {
        const dayDate = new Date(day.date);
        dayDate.setHours(0, 0, 0, 0);
        // Ne considérer que les jours passés ou aujourd'hui
        if (dayDate <= currentDate) {
            Object.entries(day.activites).forEach(([moment, details]) => {
                const activityId = `${day.id}-${moment}`;
                const isCompleted = activitiesCompleted[activityId] || false;
                if (isCompleted) return; // N'afficher que les activités non validées
                if (details.lieux && details.lieux.length > 0) {
                    details.lieux.forEach((lieu, lieuIdx) => {
                        // On ajoute toutes les activités non validées, sans filtrer par distance ni GPS
                        notdoneActivities.push({
                            day,
                            moment,
                            details,
                            lieu,
                            lieuIdx,
                            distance: (lieu.lat !== undefined && lieu.lng !== undefined && position && position.lat && position.lng) ? haversine(position.lat, position.lng, lieu.lat, lieu.lng) : null,
                            activityId
                        });
                    });
                }
            });
        }
    });
    // Trier par distance
    notdoneActivities.sort((a, b) => a.distance - b.distance);
    // Afficher les résultats
    if (notdoneActivities.length > 0) {
        container.innerHTML = '';
        notdoneActivities.forEach((activity, idx) => {
            const dateObj = new Date(activity.day.date);
            const formattedDate = dateObj.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: 'short'
            });
            let icon = 'fa-calendar-day';
            const titre = activity.day.titre.toLowerCase();
            if (titre.includes('arrivée')) icon = 'fa-plane-arrival';
            else if (titre.includes('shopping')) icon = 'fa-shopping-bag';
            else if (titre.includes('culture') || titre.includes('palace')) icon = 'fa-landmark';
            else if (titre.includes('nature') || titre.includes('randonnée')) icon = 'fa-tree';
            else if (titre.includes('concert') || titre.includes('music')) icon = 'fa-music';
            else if (titre.includes('départ')) icon = 'fa-plane-departure';
            // Identifiant unique pour chaque lieu
            const lieuId = `${activity.day.id}-${activity.moment}-${activity.lieuIdx}`;
            const isLieuCompleted = activitiesCompleted[lieuId] || false;
            const card = document.createElement('div');
            card.className = 'place-card bg-gray-50 dark:bg-gray-900 p-4 rounded-lg shadow flex flex-col md:flex-row md:items-center mb-2';
            card.innerHTML = `
                <div class="flex-1">
                    <div class="font-semibold text-indigo-700 dark:text-indigo-300 text-base flex items-center mb-1">
                        <i class="fas ${icon} mr-2"></i> ${activity.lieu.nom}
                    </div>
                    ${activity.lieu.adresse ? `<div class="text-xs text-gray-500 dark:text-gray-400 mb-1">${activity.lieu.adresse}</div>` : ''}
                    <div class="text-xs text-gray-400 italic mb-1 ${isLieuCompleted ? 'checked-lieu' : ''}">${activity.details.texte}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">${formattedDate} – ${activity.day.titre} (${activity.moment})</div>
                    ${activity.distance !== null ? `<div class="text-xs text-indigo-600 dark:text-indigo-400 font-medium mb-1">Distance : ${activity.distance.toFixed(2)} km</div>` : ''}
                </div>
                <div class="flex flex-col items-end gap-2 mt-2 md:mt-0 md:ml-4">
                    <button id="btn-lieu-${lieuId}" class="mark-done-btn rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-opacity-50 ${isLieuCompleted ? 'completed' : ''}" onclick="toggleLieuCompletionInstant('${lieuId}'); event.stopPropagation();">
                        ${isLieuCompleted ? '<i class="fas fa-check mr-1"></i> Fait' : '<i class="far fa-circle mr-1"></i> Non fait'}
                    </button>
                    <a href="${activity.lieu.kakaoMapUrl || '#'}" target="_blank" class="inline-flex items-center px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-xs">
                        <i class="fas fa-map-marker-alt mr-1"></i> Kakao
                    </a>
{{ ... }}
            `;
            container.appendChild(card);
        });
    } else {
        container.innerHTML = `
            <div class="bg-yellow-500 text-white hover:bg-yellow-600 focus:ring-yellow-400"er py-8 bg-white rounded-lg shadow-md dark:bg-gray-800">
                <div class="w-16 h-16 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-4 dark:bg-blue-900">
                    <i class="fas fa-check-circle text-blue-500 text-2xl"></i>
                </div>
                <p class="text-gray-600 font-medium dark:text-gray-300">Aucune activité à proximité</p>
                <p class="text-sm text-gray-500 mt-2 max-w-xs mx-auto dark:text-gray-400">
{{ ... }}
                    Toutes les activités passées ont été complétées ou aucune n'est dans un rayon de ${maxDistance} km<br>
                    <span class="block mt-2 text-xs text-gray-400">Astuce : Ajoutez des coordonnées GPS (lat/lng) dans vos lieux pour activer la recherche précise !</span>
                </p>
            </div>
        `;
    }
}
        // Fonctions manquantes
function toggleSearchBar() {
    const searchBar = document.getElementById('search-bar');
    searchBar.classList.toggle('hidden');
    if (!searchBar.classList.contains('hidden')) {
        document.getElementById('search-input').focus();
    }
}
// Accent/case-insensitive normalization
function normalizeStr(str) {
    return str
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0000-\u001F]/g, '') // caractères de contrôle
        .replace(/[’'`]/g, '') // apostrophes
        .replace(/[\u0300-\u036f]/g, '') // accents
        .replace(/\s+/g, ' ')
        .trim();
}

// Highlight du mot-clé dans le texte
function highlightQuery(text, query) {
    if (!query) return text;
    // Accent/case-insensitive
    const normText = normalizeStr(text);
    const normQuery = normalizeStr(query);
    if (!normText.includes(normQuery)) return text;
    // On fait un highlight sur les occurrences du mot-clé (sans accents)
    // Pour chaque match, on retrouve la position dans le texte d'origine
    const regex = new RegExp(query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
    return text.replace(regex, match => `<span class="bg-yellow-200 text-yellow-900 rounded px-1">${match}</span>`);
}

function performSearch() {
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');
    const query = searchInput.value.trim();
    if (normalizeStr(query).length < 2) {
        searchResults.classList.add('hidden');
        return;
    }
    // Recherche sur tous les champs pertinents
    const results = [];
    itineraireSeoul.forEach(day => {
        if (normalizeStr(day.titre).includes(normalizeStr(query))) {
            results.push({
                type: 'day',
                day,
                text: day.titre,
                highlight: highlightQuery(day.titre, query)
            });
        }
        Object.entries(day.activites).forEach(([moment, details]) => {
            if (normalizeStr(details.texte).includes(normalizeStr(query))) {
                results.push({
                    type: 'activity',
                    day,
                    moment,
                    text: details.texte,
                    highlight: highlightQuery(details.texte, query)
                });
            }
            if (normalizeStr(moment).includes(normalizeStr(query))) {
                results.push({
                    type: 'activity',
                    day,
                    moment,
                    text: moment,
                    highlight: highlightQuery(moment, query)
                });
            }
            if (details.lieux) {
                details.lieux.forEach(lieu => {
                    if (lieu.nom && normalizeStr(lieu.nom).includes(normalizeStr(query))) {
                        results.push({
                            type: 'place',
                            day,
                            moment,
                            lieu,
                            text: lieu.nom,
                            highlight: highlightQuery(lieu.nom, query)
                        });
                    }
                    if (lieu.adresse && normalizeStr(lieu.adresse).includes(normalizeStr(query))) {
                        results.push({
                            type: 'place',
                            day,
                            moment,
                            lieu,
                            text: lieu.adresse,
                            highlight: highlightQuery(lieu.adresse, query)
                        });
                    }
                });
            }
        });
    });
    // Affichage des résultats
    if (results.length > 0) {
        searchResults.innerHTML = '';
        searchResults.classList.remove('hidden');

        // Fermeture au clic extérieur (robuste)
        if (!window.searchOutsideListener) {
            window.searchOutsideListener = function(e) {
                if (!searchResults.contains(e.target) && e.target !== searchInput) {
                    searchResults.classList.add('hidden');
                    document.removeEventListener('mousedown', window.searchOutsideListener);
                    window.searchOutsideListener = null;
                }
            };
            document.addEventListener('mousedown', window.searchOutsideListener);
        }

        results.forEach(result => {
            const dateObj = new Date(result.day.date);
            const formattedDate = dateObj.toLocaleDateString('fr-FR', {
                day: 'numeric',
                month: 'short'
            });
            const resultItem = document.createElement('div');
            resultItem.className = 'p-3 border-b hover:bg-yellow-50 dark:hover:bg-gray-700 cursor-pointer';
            let icon = '';
            if (result.type === 'day') {
                icon = '<i class="fas fa-calendar-day text-indigo-500 mr-2"></i>';
            } else if (result.type === 'activity') {
                icon = '<i class="fas fa-tasks text-blue-500 mr-2"></i>';
            } else if (result.type === 'place') {
                icon = '<i class="fas fa-map-marker-alt text-red-500 mr-2"></i>';
            }
            let subtitle = '';
            if(result.type === 'activity') {
                subtitle = `${formattedDate} - ${result.day.titre}${result.moment ? ' (' + result.moment + ')' : ''}`;
            } else if(result.type === 'place') {
                subtitle = `${formattedDate} - ${result.day.titre}${result.moment ? ' (' + result.moment + ')' : ''}`;
                if(result.lieu && result.lieu.adresse) {
                    subtitle += `<br><span class='text-xs text-gray-400'>${result.lieu.adresse}</span>`;
                }
            } else if(result.type === 'day') {
                subtitle = `${formattedDate}`;
            }
            resultItem.innerHTML = `
                <div class="flex items-center">
                    ${icon}
                    <div>
                        <div class="font-medium">${result.highlight}</div>
                        <div class="text-xs text-gray-500">${subtitle}</div>
                    </div>
                </div>
            `;
            resultItem.addEventListener('click', () => {
                searchResults.classList.add('hidden');
                searchInput.value = '';
                showDayDetail(result.day.id);
            });
            searchResults.appendChild(resultItem);
        });
    } else {
        searchResults.innerHTML = '<div class="p-4 text-center text-red-600 font-semibold">Aucun résultat trouvé</div>';
        searchResults.classList.remove('hidden');
    }
}
function updateActiveNavigation(tab) {
    const buttons = ['btn-home', 'btn-notdone'];
    buttons.forEach(btnId => {
        const btn = document.getElementById(btnId);
        if (btn) {
            if (btnId === 'btn-' + tab) {
                btn.classList.remove('text-gray-600');
                btn.classList.add('text-indigo-600');
            } else {
                btn.classList.add('text-gray-600');
                btn.classList.remove('text-indigo-600');
            }
        }
    });
}
// Génération de la timeline
function renderTimeline() {
    const timeline = document.getElementById('timeline');
    if (!timeline) return;
    timeline.innerHTML = '';
    // Ordre chronologique classique (gauche à droite)
    const sortedDays = [...itineraireSeoul].sort((a, b) => new Date(a.date) - new Date(b.date));
    sortedDays.forEach((day, idx) => {
        const dateObj = new Date(day.date);
        const formattedDate = dateObj.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });
        // Icône selon le type de journée (exemple simple)
        let icon = 'fa-calendar-day';
        const titre = day.titre.toLowerCase();
        if (titre.includes('arrivée')) icon = 'fa-plane-arrival';
        else if (titre.includes('shopping')) icon = 'fa-shopping-bag';
        else if (titre.includes('culture') || titre.includes('palace')) icon = 'fa-landmark';
        else if (titre.includes('nature') || titre.includes('randonnée')) icon = 'fa-tree';
        else if (titre.includes('concert') || titre.includes('music')) icon = 'fa-music';
        else if (titre.includes('départ')) icon = 'fa-plane-departure';
        // Bloc cliquable horizontal
        const timelineStep = document.createElement('div');
        timelineStep.className = 'flex flex-col items-center min-w-[120px] group cursor-pointer hover:bg-indigo-50 dark:hover:bg-indigo-900 rounded-lg p-2 transition relative';
        timelineStep.innerHTML = `
            <span class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-2xl shadow-lg mb-2">
                <i class="fas ${icon}"></i>
            </span>
            <div class="text-xs text-gray-500 dark:text-gray-400 font-medium mb-1">${formattedDate}</div>
            <div class="text-sm font-semibold text-center text-gray-800 dark:text-white truncate max-w-[100px]" title="${day.titre}">
                ${day.titre.length > 24 ? day.titre.slice(0, 24) + '…' : day.titre}
            </div>
            ${idx < sortedDays.length - 1 ? '<span class="absolute top-4 right-[-24px] w-12 h-1 bg-indigo-200 dark:bg-indigo-700 z-0"></span>' : ''}
        `;
        timelineStep.addEventListener('click', () => showDayDetail(day.id));
        timeline.appendChild(timelineStep);
    });
}
</script>
<div class="hidden">
  bg-blue-100 bg-pink-100 bg-yellow-100 bg-green-100 bg-red-100 bg-gray-200 bg-indigo-100
</div>
      bg-blue-100 bg-pink-100 bg-yellow-100 bg-green-100 bg-red-100 bg-gray-200 bg-indigo-100
    </div>
<script>
// Fonction globale pour gérer la validation d'un lieu (toujours accessible)
window.toggleLieuCompletion = function(lieuId) {
    activitiesCompleted[lieuId] = !activitiesCompleted[lieuId];
    localStorage.setItem('activitiesCompleted', JSON.stringify(activitiesCompleted));
    // Rafraîchir la vue détaillée si présente
    if (typeof showDayDetail === 'function' && window.selectedDay) {
        showDayDetail(window.selectedDay.id);
    }
    // Rafraîchir la vue proximité si besoin
    if (typeof findNotdoneActivities === 'function' && window.currentPosition) {
        findNotdoneActivities(window.currentPosition);
    }
};
// Fonction globale pour validation instantanée d'un lieu dans la vue jour
window.toggleLieuCompletionInstant = function(lieuId) {
    activitiesCompleted[lieuId] = !activitiesCompleted[lieuId];
    localStorage.setItem('activitiesCompleted', JSON.stringify(activitiesCompleted));
    // MAJ immédiate du bouton et du label
    syncLieuButtonsUI();
};
// Synchronise l'état UI de tous les boutons et labels de lieux selon activitiesCompleted
function syncLieuButtonsUI() {
    Object.keys(activitiesCompleted).forEach(lieuId => {
        const btn = document.getElementById('btn-lieu-' + lieuId);
        const lieuNom = document.getElementById('lieu-nom-' + lieuId);
        if (btn) {
            if (activitiesCompleted[lieuId]) {
                btn.classList.add('completed');
                btn.innerHTML = '<i class="fas fa-check mr-1"></i> Fait';
            } else {
                btn.classList.remove('completed');
                btn.innerHTML = '<i class="far fa-circle mr-1"></i> Non fait';
            }
        }
        if (lieuNom) {
            if (activitiesCompleted[lieuId]) {
                lieuNom.classList.add('checked-lieu');
            } else {
                lieuNom.classList.remove('checked-lieu');
            }
        }
    });
}
</script>
</body>
</html>
